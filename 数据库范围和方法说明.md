#### 数据库范围
04q1-25q1 共76个季度
There are 76 quarters from Q1 2004 to Q1 2025.

#### 使用工具
|               | Version         |
|-------------------|-----------------------|
| Python            | 3.10  |
| Pandas            | 2.0       |
| NumPy             | 1.24      |
| MySQL             | 8.0                 |

#### Medhod部分写法
- 参照如下示例或者相关论文来写均可

The data were sourced from the U.S. Food and Drug Administration (FDA) Adverse Event Reporting System (FAERS) database (fis.fda.gov/extensions/FPD-QDE-FAERS.html). This study utilized the raw adverse event report data in ASCII format obtained from the website, covering a total of 77 quarters from the first quarter of 2004 to the first quarter of 2023. The MySQL database management system was used to store, manage, and integrate the database, which contains information such as drug-related adverse events, adverse event reporting dates and outcomes, routes of administration, dosages, cumulative dosages, patient gender and age, and reporting countries.

Data Cleaning and Standardization
Given the large time span of 77 quarters in the FAERS database, there were significant variations in data storage formats and standards. This study employed MySQL to address the differences in data storage rules and ensure uniformity. Using the first quarter of 2023 as the standard based on the official documentation, all quarters' data were processed through SQL queries to perform tasks such as string mapping, format standardization, and data type conversion to meet the requirements of statistical analysis.

In accordance with the "Medical Dictionary for Regulatory Activities" (MedDRA) , preferred terms were standardized, and missing or unknown values in the dataset were handled. Adverse events were categorized into System Organ Classes (SOC) as defined by MedDRA. Records containing spelling errors, unrecognizable or meaningless preferred terms (PT) or drug names, and duplicate entries were identified and excluded using SQL queries and data validation techniques.

---
#### Data Cleaning and Merging

This study utilized Python and MySQL technologies to clean and merge data, ensuring data integrity and consistency. The data was sourced from multiple quarterly database tables, covering various dimensions such as patient information, medication details, adverse event reports, indications, and outcome data. The detailed operation steps are as follows:

1. **Merging of Base Data**  
   SQL queries were used to integrate information from different database tables into a unified table. The queries utilized `INNER JOIN` and `LEFT JOIN` operations to relate data across different tables while retaining all necessary fields.  
   - `INNER JOIN`: Used to join the demographic information table (DEMO) with the drug information table (DRUG). Target drugs (e.g., Esomeprazole, Nexium, Inexium, and Vimovo) were filtered from the drug table.  
   - `LEFT JOIN`: Linked the adverse event information (REAC), indication information (INDI), and outcome information (OUTC) tables to the main data table to retrieve complete patient records.

   Example code:
   ```sql
   SELECT DISTINCT
       m.primaryid,
       d.caseid,
       d.age,
       d.age_cod,
        ....
       r.pt,
       i.indi_pt,
       o.outc_cod
   FROM 
       [dbo].[MergedDemoAll] m
   INNER JOIN 
       [FDA2013Q2].[dbo].[DEMO13Q2] d ON m.primaryid = d.primaryid
   INNER JOIN 
       [FDA2013Q2].[dbo].[DRUG13Q2] dr ON m.primaryid = dr.primaryid
       AND (dr.drugname LIKE '%Esomeprazole%'
            OR dr.drugname LIKE '%nexium%'
            OR dr.drugname LIKE '%inexium%'
            OR dr.drugname LIKE '%Vimovo%')
   LEFT JOIN 
       [FDA2013Q2].[dbo].[REAC13Q2] r ON m.primaryid = r.primaryid
   LEFT JOIN 
       [FDA2013Q2].[dbo].[INDI13Q2] i ON m.primaryid = i.primaryid
   LEFT JOIN 
       [FDA2013Q2].[dbo].[OUTC13Q2] o ON m.primaryid = o.primaryid;
   ```

2. **Removing Invalid Data**  
   Invalid or flagged records were removed from the dataset. These records were sourced from deletion tables published quarterly by the FDA.  
   - `UNION` operations were used to consolidate deletion tables across multiple quarters into a single list of records to be removed.  
   - The consolidated list was used to exclude invalid records from the merged main dataset to generate a cleaned data set.

   Example code:
   ```sql
   SELECT primaryid FROM [FDA2024Q2].dbo.[DELETE24Q2]
       UNION
       -- Records deleted in 2024Q3
       SELECT primaryid FROM [FDA2024Q3].dbo.[DELETE24Q3]
       UNION
       -- Records deleted in 2024Q4
       SELECT primaryid FROM [FDA2024Q4].dbo.[DELETE24Q4]
   );

   -- Count the number of records in the cleaned dataset
   SELECT COUNT(*) AS CleanedRecordCount
   FROM MergedDemoAll_Cleaned2;
   ```

3. **Result Validation**  
   The cleaned data table was validated by checking record counts to ensure the correctness of the cleaning process. The number of records in the cleaned dataset was compared with the expected count.

#### Technical Implementation

In this study, Python was used to execute SQL scripts for data processing tasks. The MySQL database served as the backend for data storage and querying. Data cleaning and merging tasks were primarily executed using SQL statements, with Python code handling task scheduling and workflow management.




