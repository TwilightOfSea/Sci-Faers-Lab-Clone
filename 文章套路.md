友情链接：[软件操作说明](./软件操作说明.md)

## 总体概述和目录
- 本篇列举了一些套路，以及如何利用SciFaersLab实现
- #### 目录命名规则：
- 写数据库挖掘文章就像**搭积木**一样，各种套路和分析方法就是我们可以使用的零件。我们可以自由地DIY设计框架，将这些零件拼接组合，最终构建出想要的作品（论文）。
  - 在这个过程中，有许多**基础通用零件**，通用性强，适配度高。它们就像积木中最常用且不可或缺的模块。这些基础模块的标题以**F开头标识**，可以灵活地融入到任何分析套路中。
  - 也有许多专用零件，决定了整篇文章的走向和核心价值，或者就是**套路本身**。这些专用模块以字母**S开头标识**。
- 左侧的《FAERS论文收藏集》中有分套路整理好的文章，按需查看。
### 扫盲
- 这个课题的核心目的是探究药物和不良反应二者之间的关系，适用这个分析场景的统计学方法有：ROR、PRR、BCPNN、MGPS等等。原理都在衡量某药物的某不良反应发生情况在整个数据库背景下的不对称性。这几种算法的Features均来自于比例失衡四格表。
- 算法公式、阈值和在线计算器请见附加文件。算法越复杂，其可解释性越低，尤其以BCPNN、经验贝叶斯为代表的贝叶斯方法为盛，有余力的话可以去深入推导，这是纯数学研究。
- 本软件涉及到的机器学习方法，之所以表现有时优于传统算法，并非因为常见的这些机器学习方法比传统方法更加高明，而是因为我们抽提出了更多features，并将之作为影响因素去考虑。
- 入门视频：[从零开始的Faers数据库挖掘](https://www.bilibili.com/video/BV1uifhYdEQn/?vd_source=4559e47be658149d4030a5ba8050d24e)

### 一般文章结构：
- <img src="./pic/基本套路流程.png" alt="文章中典型流程图" width="150">  


### F|必备图像清单：
1. 流程图（查看运行记录，建议在[这个网站绘图](https://app.diagrams.net/) ，模板在附件中找得到，直接把文件拖进去就完事）

- <img src="./pic/文章中典型流程图.png" alt="文章中典型流程图" width="350">  

2. 基础数据统计表（导出报告的基线数据复制粘贴即可）  
 
- <img src="./pic/基线数据范文演示.png" alt="基线数据范文演示" width="150">
3. SOC层级不良事件分布（脚本编号[1008]/[1001]等）  
 
- <img src="./pic/信号值（SOC）-频数统计图单色_temp.png" alt="信号值（SOC）-频数统计图单色_temp" width="350">    
- <img src="./pic/信号森林图(复杂).png" alt="信号森林图(复杂)" width="350"> 
4. PT层级不良事件分布（脚本编号[1007]/[1008]等）
 
- <img src="./pic/文章中出现的典型信号值结果.png" alt="文章中出现的典型信号值结果" width="350">    
- <img src="./pic/PT条形图.png" alt="PT条形图" width="350">  
  
5. 累积发生率分析（生存分析）和韦伯分布计算（脚本编号[2012]/[2010]/[P1011]等）
- <img src="./pic/累积发生率.png" alt="累积发生率" width="350">   
- <img src="./pic/累积发生率-示例.png" alt="累积发生率-示例" width="350">   
- <img src="./pic/韦伯分布参数.png" alt="韦伯分布参数" width="350">
- <img src="./pic/韦伯分布-NEW.png" alt="韦伯分布-NEW" width="350"> 

### F|亚组分析
- 此项目的是精确定位分析类群。也是整个课题方向的重中之重，定位于某个或者某类不良反应分析，也能算是亚组分析的内容。
**识别风险差异**：通过分析不同人群（年龄、性别、基础疾病等）对药物反应的差异，识别特定风险因素。例如，≥65岁患者易发炎症反应，而其他成人群体多发白内障，表明年龄是影响药物安全性的重要因素。如下图反映男女亚组对于不同不良反应的风险差异[P1022]。
**支持个性化用药**：为临床制定个体化监测方案提供循证依据，如针对老年患者需重点预防炎症反应。
**增强结果可信度**：通过展示不同亚组间的差异性，证明研究结论的普适性，避免过于绝对化的结论。
**提升研究深度**：深入挖掘隐藏的影响因素（如年龄、并发症等），为后续机制研究提供重要线索，如老年患者代谢变化对药物反应的影响。
**满足学术规范**：符合多数期刊对关键变量分析的要求，体现研究的科学严谨性。
**指导临床实践**：精准识别高风险人群，帮助临床医生快速确定重点监护对象，提高医疗质量和安全性。
- 通过两种**亚组分析工具**精细化拆分，支持按任意标准划分人群亚组（如0-2岁、2-3岁等年龄段的细分），操作方法详见[软件操作说明](./软件操作说明.md)
- <img src="./pic/[P1022]两亚组-PT风险对比-火山图-type2_temp.png" alt="亚组显著性对比森林图" width="450">

### 多药分析和单药分析
- 多种药物分析的核心是比较同类药物的安全性差异。比较治疗同一种疾病的多种药物之间的风险差异，能起一定针对性的指导临床用药作用。
  - 分析这些药物，共同出现了哪些发生频数较高的不良事件
  - 分析这些药物，在不同PT上/同一类PT上的信号强弱对比。
  - 引发不良反应的共性、信号强弱程度和集中趋势。
  - 结合亚组分析。比如看某个药在女性人群中引起不良反应A的风险大，但是另一个药物，在女性群体中却没有这种趋势。可以用作图工具画两个亚组显著性对比火山图来描述。
  - 结合生存分析：计算患者在特定时间内未发生不良反应的概率（生存函数）或累积风险概率。
  - <img src="./pic/多药信号对比ROR.png" alt="多药信号对比ROR" width="450">
  - <img src="./pic/面积堆叠ROR_temp.png" alt="面积堆叠ROR_temp" width="450">
  - <img src="./pic/亚组显著性对比森林图.png" alt="亚组显著性对比森林图" width="450">
  - <img src="./pic/多药累积发生率对比.png" alt="多药累积发生率对比" width="350">

- 多药分析的解释，可以从毒理、靶点、分子机制的角度去入手，适当结合一些基因组学的内容也可以拿高分。


### 联用药物分析
- [视频教程](https://www.bilibili.com/video/BV1u93tzgE1x/)
#### 1. 药物联用情况分析
- **数据来源**: 信号检测系统导出的原始数据中的"DRUG_GOAL.csv"
- **分析工具**: 小工具：药物-作用代码-对应的不良报告个数计数器.exe
- **可视化**: 使用[S2015]绘制树形图展示联用情况
  - <img src="./pic/联用药物树形图.png" alt="联用药物树形图" width="450">

#### 2. 亚组分析方法
- 用**亚组分析工具（小数据）** 将信号检测系统导出的原始数据报告分为**联用组**和**未联用组**，并且可针对特定不良反应或亚组人群进行进一步的针对性分析。
- 配合**信息统计工具**和**绘图工具包**实现如下分析角度:
  - 不良反应发生情况
  - 生存分析：诱发时间和韦伯分布
  - 人口学信息
  - 性别差异
  - 年龄差异
  - 综合的多因素逻辑回归

#### 3. 操作细节
  - <img src="./pic/药物联用输入示例.png" alt="药物联用输入示例" width="150">

注意：实际使用时，药物可能有多个名称，需要用**英文小括号**括起来，每种药物用'+'连接。即使药物仅有一个名称，也需要用小括号括起来。具体见下面的例子：
```
()&() #两种药物联用
()#() #某种药物单独使用,排除另一种药物
()&()&()... #两种或多种药物联用
()#()#()... #某种药物单独使用,排除其他药物
()&()#()#()... #两种药物联合使用，同时排除其他药物
```
##### 示例1: 两药联用：阿司匹林与氯吡格雷
- **药物信息**:
  - 阿司匹林: Aspirin, NORGESIC
  - 氯吡格雷: Clopidogrel, PLAVIX, CLOPIDOGREL BISULFATE
- **分析语句**:
  - 单独使用: (Aspirin+NORGESIC)#(Clopidogrel+PLAVIX+CLOPIDOGREL BISULFATE)
  - 联合使用: (Aspirin+NORGESIC)&(Clopidogrel+PLAVIX+CLOPIDOGREL BISULFATE)

##### 示例2: 多药联用
- **药物I与ABC联用分析**:
  - I单独使用: I#A#B#C
  - I联合A使用: I&A#B#C
  - I联合B使用: I&B#A#C
  - I联合C使用: I&C#A#B



### 用于治疗某种适应症下的药物的不良事件分析挖掘
- [操作演示视频](https://www.bilibili.com/video/BV1CDVpz9EXK/)
- 把分析范围从总体人群，限制在患有某类特定疾病的人群中
- 方法：用亚组分析工具（大数据）分割数据库，在分割后的数据库中做挖掘。
- 在划分完成的数据库后，执行信号监测系统。剩下的分析步骤和其他套路一致。


### S|分析某种不良反应和不同药物的关联
#### 1. 视频教程
- **学习资源**：[视频教程链接](https://www.bilibili.com/video/BV1EJ3JzhE5d/)

#### 2. 亚组分析工具（大数据）
- 用于筛选某个或某些PT（Preferred Term，首选术语），如果是筛选多个，请用'+'连接。若筛选SMQ请见“使用前必读”文件夹内的'SMQ_pt.xlsx'

#### 3. 数据去重
- 处理导出的数据：使用小工具：去重进行数据去重。

#### 4. 数据统计与可视化
- **信息统计工具**：载入去重后的数据，导出基线数据到一个表格中。
- **小工具：药物-作用代码统计**：载入去重后的数据，统计不良反应对应的药物数量。
- **可视化**：生成泡泡图和树状图，展示不同药物引起目标不良反应的分布情况（参考[S2012]、[S2014]）。

#### 5. 信号值计算和目标药物的亚组人群分析
- 使用信号监测系统计算目标药物与不良反应之间的相关信号强度。
- 信号检测系统的导出报告，通过亚组分析（小数据）划分出来目标的PT亚组，进行细化的亚组分析，方法和其他套路一致

#### 补充：若需要对这个不良反应的报告进行整体分析：
- 在执行完第三步后，使用小工具：转CSV，将去重后的数据保存为可以直接打开的csv格式，再使用信息统计工具生成基线数据，也可以通过亚组分析（小数据）进行细化的亚组分析。
    
### F|诱发时间曲线和韦伯分布 
- 不良报告的诱发时间分析越来越常出现在论文中，现在基本每个文章都有。[视频教程](https://www.bilibili.com/video/BV1EF75zhEAj/)
- 可以对比两种不同药物的诱发时间，也可以对比在老年人和年轻人群体中的诱发时间，也可以对比引起不良反应A的报告的诱发时间，和B有什么不同。任何亚组分析都能够画下边的图，然后再做一下下边提到的韦伯分布：
-  <img src="./pic/多亚族累计发生率.png" alt="多亚族累计发生率" width="350">
- [3001][C0009]Time-to-onset条形图绘制
  <img src="./pic/诱发时间条形图.png" alt="诱发时间条形图" width="350">
- [2010]累积发生率
  <img src="./pic/累积发生率.png" alt="累积发生率" width="350">
- [2005]诱发时间韦伯分布（ WSP analysis）：使用 bootstrap 方法计算置信区间，可调整脚本中n_iterations的取值来改变重采样次数，default = 100
  <img src="./pic/韦伯分布-NEW.png" alt="韦伯分布-NEW" width="450">
- **Weibull分布参数**：
    - **Scale (α)**：尺度参数，表示特征寿命（63.2%的样本发生失效的时间），其95%置信区间（CI）反映参数估计的稳定性。
    - **Shape (β)**：形状参数，决定失效风险随时间的变化模式：
        - β < 1：风险递减（早期失效）。
        - β = 1：风险恒定（随机失效）。
        - β > 1：风险递增（损耗失效）。
- **Failure Type**：失效类型，基于形状参数（β）的统计学判断。
    1. **Early Failure（早期失效）**：  
        - **条件**：形状参数（β）的95%置信区间不包含1，且β < 1。  
        - **含义**：失效风险随时间递减，早期事件发生率高（如药物不良反应早期出现）。  
        - **示例**：肝功异常（β=0.80，CI=0.65–0.94）和肝衰竭（β=0.69，CI=0.48–0.90）。

    2. **Random Failure（随机失效）**：  
        - **条件**：形状参数（β）的95%置信区间包含1。  
        - **含义**：失效风险恒定，事件随机发生（符合指数分布）。  
        - **示例**：疾病进展（β=0.83，CI=0.65–1.00）和腹水（β=0.87，CI=0.73–1.01）。    
          
          <img src="./pic/韦伯分布参数.png" alt="韦伯分布参数" width="450">

### S|机器学习：预测药物的不良反应，与传统方法的性能比对
- [bilibili:给懒人看的FAERS机器学习教程](https://www.bilibili.com/video/BV1su39zKEPX/)
- 执行特征提取工具，得到特征提取报告。运行脚本[S3002]等，设置模型参数和Gold Standard，自动完成建模、AUC曲线绘制、模型性能打分。具体流程详见附件。
-  <img src="./pic/ML.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML1.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML2.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML3.png" alt="多亚族累计发生率" width="350">


### F|不良事件发生频数分析
- 此项为分析目标药物的发生了哪些不良反应事件，发生频数怎么样，可以用亚组分析工具来分析总体、不同亚组的情况差异。复制表格或用下方图片均可。
- <img src="./pic/阿司匹林总体情况.png" alt="阿司匹林总体情况" width="350">   
- <img src="./pic/老人不良事件统计.png" alt="老人不良事件统计" width="350">   
- <img src="./pic/PT条形图.png" alt="PT条形图" width="350">      

### F|信号值（PT）分析（只讲典型案例）
- [1004]多算法韦恩分布
  
  <img src="./pic/韦恩.png" alt="韦恩" width="250">
- [1002]TOP不良事件条形图  

  <img src="./pic/PT条形图.png" alt="PT条形图" width="350">
- [P1005]多药对比信号（PT）-Top30热力图ROR

  <img src="./pic/多药信号对比ROR.png" alt="多药信号对比ROR" width="350">
- [1010]、[1011]ROR火山图  

  <img src="./pic/ROR火山.png" alt="ROR火山" width="350">
- [1005]、[1012]森林图  
  <img src="./pic/新图像-ror森林.png" alt="新图像-ror森林" width="350">


### F|信号值（SOC）分析（只讲典型案例）
- 整体看一下，目标药物的不良事件主要集中在哪些器官系统层级
- [1008]条形图  

  <img src="./pic/信号值（SOC）-频数统计图单色_temp.png" alt="ROR火山" width="350">
- [1000]森林图  

  <img src="./pic/信号森林图(复杂).png" alt="ROR火山" width="450">

    
### F|性别，年龄和年龄-性别的累计变化分析：
- [2004]、[2008]、[C0002]、[C0005]等  
  <img src="./pic/年龄段分布图.png" alt="年龄段分布图" width="350">
- [3002]年龄-性别频数分布-分组柱状图等
- [C0006]数据统计表-年龄-性别频数分布-堆叠柱状图等  

  <img src="./pic/年龄、性别条形图.png" alt="年龄、性别条形图" width="350">
    
### F|不良报告上报者分析：
- 数据库中的代号是二字代码，看不明白的，去看附件中的文件
- [2007]、[C0004]作图
    
### F|不良反应上报时间分析：
- [2011]、[2002]、[2001]等
    
### F|体重段位分析\国家分析：
- [2008]、[2006]
    

    
    
    