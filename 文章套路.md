友情链接：[软件操作说明](./软件操作说明.md)

## 总体概述和目录
- 本篇列举了一些套路，以及如何利用SciFaersLab实现
- #### 目录命名规则：
- 写数据库挖掘文章就像**搭积木**一样，各种套路和分析方法就是我们可以使用的零件。我们可以自由地DIY设计框架，将这些零件拼接组合，最终构建出想要的作品（论文）。
  - 在这个过程中，有许多**基础通用零件**，通用性强，适配度高。它们就像积木中最常用且不可或缺的模块。这些基础模块的标题以**F开头标识**，可以灵活地融入到任何分析套路中。
  - 也有许多专用零件，决定了整篇文章的走向和核心价值，或者就是**套路本身**。这些专用模块以字母**S开头标识**。
  
- #### 最常见套路归纳：
  1. 一种药物（单药）综合PT分析
  2. 一类药物（多药）综合PT分析
  3. 一种药物（单药）某类PT分析
  4. 一类药物（多药）针对某类PT分析
  5. 用于治疗某疾病的单药或多药的综合或某类PT分析
  6. 一类PT-分析和不同药物的关联
### 扫盲
- 这个课题的核心目的是探究药物和不良反应二者之间的关系，适用这个分析场景的统计学方法有：ROR、PRR、BCPNN、MGPS等等。原理都在衡量某药物的某不良反应发生情况在整个数据库背景下的不对称性。这几种算法的Features均来自于比例失衡四格表。
- 算法公式、阈值和在线计算器请见附加文件。算法越复杂，其可解释性越低，尤其以BCPNN、经验贝叶斯为代表的贝叶斯方法为盛，有余力的话可以去深入推导，这是纯数学研究。
- 本软件涉及到的机器学习方法，之所以表现有时优于传统算法，并非因为常见的这些机器学习方法比传统方法更加高明，而是因为我们抽提出了更多features，并将之作为影响因素去考虑。
- 入门视频：[从零开始的Faers数据库挖掘](https://www.bilibili.com/video/BV1uifhYdEQn/?vd_source=4559e47be658149d4030a5ba8050d24e)

### 一般文章结构：
- <img src="./pic/基本套路流程.png" alt="文章中典型流程图" width="150">  


### F|必备图像清单：
1. 流程图（查看运行记录，建议在[这个网站绘图](https://app.diagrams.net/) ，模板在附件中找得到，直接把文件拖进去就完事）

- <img src="./pic/文章中典型流程图.png" alt="文章中典型流程图" width="350">  

2. 基础数据统计表（导出报告的基线数据复制粘贴即可）  
 
- <img src="./pic/基线数据范文演示.png" alt="基线数据范文演示" width="150">
3. SOC层级不良事件分布（脚本编号[1008]/[1001]等）  
 
- <img src="./pic/信号值（SOC）-频数统计图单色_temp.png" alt="信号值（SOC）-频数统计图单色_temp" width="350">    
- <img src="./pic/信号森林图(复杂).png" alt="信号森林图(复杂)" width="350"> 
4. PT层级不良事件分布（脚本编号[1007]/[1008]等）
 
- <img src="./pic/文章中出现的典型信号值结果.png" alt="文章中出现的典型信号值结果" width="350">    
- <img src="./pic/PT条形图.png" alt="PT条形图" width="350">  
  
5. 累积发生率分析（生存分析）和韦伯分布计算（脚本编号[2012]/[2010]/[P1011]等）
- <img src="./pic/累积发生率.png" alt="累积发生率" width="350">   
- <img src="./pic/累积发生率-示例.png" alt="累积发生率-示例" width="350">   
- <img src="./pic/韦伯分布参数.png" alt="韦伯分布参数" width="350">
- <img src="./pic/韦伯分布-NEW.png" alt="韦伯分布-NEW" width="350"> 

### F|亚组分析
- 此项目的是精确定位分析类群。也是整个课题方向的重中之重，定位于某个或者某类不良反应分析，也能算是亚组分析的内容。
**识别风险差异**：通过分析不同人群（年龄、性别、基础疾病等）对药物反应的差异，识别特定风险因素。例如，≥65岁患者易发炎症反应，而其他成人群体多发白内障，表明年龄是影响药物安全性的重要因素。如下图反映男女亚组对于不同不良反应的风险差异[P1022]。
**支持个性化用药**：为临床制定个体化监测方案提供循证依据，如针对老年患者需重点预防炎症反应。
**增强结果可信度**：通过展示不同亚组间的差异性，证明研究结论的普适性，避免过于绝对化的结论。
**提升研究深度**：深入挖掘隐藏的影响因素（如年龄、并发症等），为后续机制研究提供重要线索，如老年患者代谢变化对药物反应的影响。
**满足学术规范**：符合多数期刊对关键变量分析的要求，体现研究的科学严谨性。
**指导临床实践**：精准识别高风险人群，帮助临床医生快速确定重点监护对象，提高医疗质量和安全性。
- 精细化拆分，支持按任意标准划分人群亚组（如1-3岁、4-7岁等年龄段的细分），操作方法详见[软件操作说明](./软件操作说明.md)
- <img src="./pic/[P1022]两亚组-PT风险对比-火山图-type2_temp.png" alt="亚组显著性对比森林图" width="450">

### 多药分析和单药分析
- 多种药物分析的核心是比较同类药物的安全性差异。比较治疗同一种疾病的多种药物之间的风险差异，能起一定针对性的指导临床用药作用。
  - 分析这些药物，共同出现了哪些发生频数较高的不良事件
  - 分析这些药物，在不同PT上/同一类PT上的信号强弱对比。
  - 引发不良反应的共性、信号强弱程度和集中趋势。
  - 结合亚组分析。比如看某个药在女性人群中引起不良反应A的风险大，但是另一个药物，在女性群体中却没有这种趋势。可以用作图工具画两个亚组显著性对比火山图来描述。
  - 结合生存分析：计算患者在特定时间内未发生不良反应的概率（生存函数）或累积风险概率。
  - <img src="./pic/多药信号对比ROR.png" alt="多药信号对比ROR" width="450">
  - <img src="./pic/面积堆叠ROR_temp.png" alt="面积堆叠ROR_temp" width="450">
  - <img src="./pic/亚组显著性对比森林图.png" alt="亚组显著性对比森林图" width="450">
  - <img src="./pic/多药累积发生率对比.png" alt="多药累积发生率对比" width="350">

- 多药分析的解释，可以从毒理、靶点、分子机制的角度去入手，适当结合一些基因组学的内容也可以拿高分。


### 联用药物分析
- 找到什么药物和目标药物联用的多
在FAERS数据库中，DRUG部分数据库存储着用药情况。在执行信号检测系统后，在导出报告中的原始数据文件中，存储着目标药物作为首要怀疑药物的不良原始报告数据，其中DRUG_GOAL文件是用药记录。
  - 运行小工具：药物-作用代码-对应的不良报告个数计数器.exe，选择DRUG_GOAL.csv，会导出一个计数表格，即可查看药物使用情况，可以用[S2015]画一个树形图看看联用情况
  - <img src="./pic/联用药物树形图.png" alt="联用药物树形图" width="450">

- 这个分析可以在亚组分析工具（小数据）中完成，把原始数据拆分成联用和未联用的两个亚组，再分别用信息统计工具统计不良反应发生情况和人口学等信息。执行完毕后，两个亚组的不良事件分布情况，会显示在第一个工作表中。
  - 重点还是看怎么对结果做出解释和图形化，方法与一般的亚组分析没有什么区别
  - 也可以再加上一些亚组分析角度，比如男女差异/老少差异等等

### 用于治疗某种适应症下的药物的不良事件分析挖掘
- 把分析范围从总体人群，限制在患有某类特定疾病的人群中
- 方法：用亚组分析工具（大数据）分割数据库，在分割后的数据库中做挖掘。[操作演示视频](https://www.bilibili.com/video/BV1CDVpz9EXK/)
- 在划分完成的数据库后，执行信号监测系统。剩下的分析步骤和其他套路一致。


### S|分析某种不良反应和不同药物的关联
- 亚组分析工具（大数据）：筛选某个或者某些PT
- 运行小工具：去重，处理导出的数据
- 运行小工具：药物-作用代码-对应的不良报告个数计数器，看目标不良反应是哪些药物引起的.[S2012]、[S2014]作泡泡和树状图
- 信号监测系统：看这些药物和此不良反应之间的相关信号计算
- 信息统计工具：制表+各种脚本作图
- 亚组分析：可针对年龄段、性别等进一步分析，作图。先用csv格式转换工具、再用亚组分析工具（小数据），再如法炮制分析作图
- 此不良反应的并发症分析：树状图、泡泡矩阵、层次聚类算法
    
### F|诱发时间曲线和韦伯分布
- 不良报告的诱发时间分析越来越常出现在论文中，现在基本每个文章都有。
- 可以对比两种不同药物的诱发时间，也可以对比在老年人和年轻人群体中的诱发时间，也可以对比引起不良反应A的报告的诱发时间，和B有什么不同。任何亚组分析都能够画下边的图，然后再做一下下边提到的韦伯分布：
-  <img src="./pic/多亚族累计发生率.png" alt="多亚族累计发生率" width="350">
- [3001][C0009]Time-to-onset条形图绘制
  <img src="./pic/诱发时间条形图.png" alt="诱发时间条形图" width="350">
- [2010]累积发生率
  <img src="./pic/累积发生率.png" alt="累积发生率" width="350">
- [2005]诱发时间韦伯分布（ WSP analysis）：使用 bootstrap 方法计算置信区间，可调整脚本中n_iterations的取值来改变重采样次数，default = 100
  <img src="./pic/韦伯分布-NEW.png" alt="韦伯分布-NEW" width="450">
- **Weibull分布参数**：
    - **Scale (α)**：尺度参数，表示特征寿命（63.2%的样本发生失效的时间），其95%置信区间（CI）反映参数估计的稳定性。
    - **Shape (β)**：形状参数，决定失效风险随时间的变化模式：
        - β < 1：风险递减（早期失效）。
        - β = 1：风险恒定（随机失效）。
        - β > 1：风险递增（损耗失效）。
- **Failure Type**：失效类型，基于形状参数（β）的统计学判断。
    1. **Early Failure（早期失效）**：  
        - **条件**：形状参数（β）的95%置信区间不包含1，且β < 1。  
        - **含义**：失效风险随时间递减，早期事件发生率高（如药物不良反应早期出现）。  
        - **示例**：肝功异常（β=0.80，CI=0.65–0.94）和肝衰竭（β=0.69，CI=0.48–0.90）。

    2. **Random Failure（随机失效）**：  
        - **条件**：形状参数（β）的95%置信区间包含1。  
        - **含义**：失效风险恒定，事件随机发生（符合指数分布）。  
        - **示例**：疾病进展（β=0.83，CI=0.65–1.00）和腹水（β=0.87，CI=0.73–1.01）。    
          
          <img src="./pic/韦伯分布参数.png" alt="韦伯分布参数" width="450">

### S|机器学习：预测药物的不良反应，与传统方法的性能比对
- 执行特征提取工具，得到特征提取报告。运行脚本[S3002]等，设置模型参数和Gold Standard，自动完成建模、AUC曲线绘制、模型性能打分。详见版本更新邮件。
-  <img src="./pic/ML.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML1.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML2.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML3.png" alt="多亚族累计发生率" width="350">


### F|不良事件发生频数分析
- 此项为分析目标药物的发生了哪些不良反应事件，发生频数怎么样，可以用亚组分析工具来分析总体、不同亚组的情况差异。复制表格或用下方图片均可。
- <img src="./pic/阿司匹林总体情况.png" alt="阿司匹林总体情况" width="350">   
- <img src="./pic/老人不良事件统计.png" alt="老人不良事件统计" width="350">   
- <img src="./pic/PT条形图.png" alt="PT条形图" width="350">      

### F|信号值（PT）分析（只讲典型案例）
- [1004]多算法韦恩分布
  
  <img src="./pic/韦恩.png" alt="韦恩" width="250">
- [1002]TOP不良事件条形图  

  <img src="./pic/PT条形图.png" alt="PT条形图" width="350">
- [P1005]多药对比信号（PT）-Top30热力图ROR

  <img src="./pic/多药信号对比ROR.png" alt="多药信号对比ROR" width="350">
- [1010]、[1011]ROR火山图  

  <img src="./pic/ROR火山.png" alt="ROR火山" width="350">
- [1005]、[1012]森林图  
  <img src="./pic/新图像-ror森林.png" alt="新图像-ror森林" width="350">


### F|信号值（SOC）分析（只讲典型案例）
- 整体看一下，目标药物的不良事件主要集中在哪些器官系统层级
- [1008]条形图  

  <img src="./pic/信号值（SOC）-频数统计图单色_temp.png" alt="ROR火山" width="350">
- [1000]森林图  

  <img src="./pic/信号森林图(复杂).png" alt="ROR火山" width="450">

    
### F|性别，年龄和年龄-性别的累计变化分析：
- [2004]、[2008]、[C0002]、[C0005]等  
  <img src="./pic/年龄段分布图.png" alt="年龄段分布图" width="350">
- [3002]年龄-性别频数分布-分组柱状图等
- [C0006]数据统计表-年龄-性别频数分布-堆叠柱状图等  

  <img src="./pic/年龄、性别条形图.png" alt="年龄、性别条形图" width="350">
    
### F|不良报告上报者分析：
- 数据库中的代号是二字代码，看不明白的，去看附件中的文件
- [2007]、[C0004]作图
    
### F|不良反应上报时间分析：
- [2011]、[2002]、[2001]等
    
### F|体重段位分析\国家分析：
- [2008]、[2006]
    

    
    
    