友情链接：[如何用软件实现90%的文章套路](./文章套路.md)

## 软件操作

### 一、不良数据库信号监测系统  
- [B站教学视频](https://www.bilibili.com/video/BV136JEzqEtt/)
- #### 界面
1. 顶部输入框：输入目标药物名称，可通过下列几个推荐的网址综合查询（英文，包括API名称、商品名、研发代号等等）
    - https://www.drugfuture.com/
    - https://zh.wikipedia.org/zh-cn/
    - https://www.chemicalbook.com/ProductIndex.aspx
    - https://www.google.com
    - https://www.pharmcube.com/product/PharmaGo/index
    
2. 复选框：选择筛选算法，是否勾选区别不大，均会生成下列两种文件
    - 生成文件："./Report/导出报告/不良反应信号报告/不良反应信号(PT).xlsx"：筛选前结果
    - 生成文件："./Report/导出报告/不良反应信号报告/根据框选的算法筛选后的不良反应信号(PT).xlsx"，筛选后结果

3. 底部按钮：“开始分析”
    - 读取"./Lib_Data/Data_Lake"文件夹中的数据库文件，根据所输入的药物名进行信号检测
    - 请确保这个文件夹存在。  
    
    <img src="./pic/新版界面2.png" alt="启动截图" width="550">
4. 简洁、优雅的UI界面，右上角可以自由切换白天/黑夜模式

- #### 导出报告  

    <img src="./pic/导出报告.png" alt="导出报告" width="450">  

1. 运行记录的TXT文件：记录着运行过程中产生的一些信息：用于绘制流程图
    - 注意区分不良报告和不良事件的定义：一份不良报告中可能有多个不良事件  
    
2. 基线数据：  
   
   <img src="./pic/基线数据.png" alt="基线数据" width="450">

    - 作用之一是在文章中做出这样的表格，展示出国家、性别、年龄段等特征：  
  
    <img src="./pic/基线数据范文演示.png" alt="基线数据范文演示" width="250">  

    - 作用之二是配合其他一些分析脚本做后续的绘图（如下图）  
  
    <img src="./pic/[3002]年龄-性别频数分布-分组柱状图_temp.png" alt="画图指引" width="350">
    
3. 不良报告原始数据：
    - 不良原始数据，完全来自于FDA的公开数据库，可以直接打开
    - 还可以用于亚组分析工具和信息统计工具做进一步的分析和画图(如累积发生率分析、多元逻辑回归分析等等...)  
  
    <img src="./pic/多亚族累计发生率.png" alt="诱发时间条形图" width="250">
    <img src="./pic/逻辑回归pic1.png" alt="逻辑回归pic1" width="250">
4. 不良反应信号报告：
    - 不良反应信号(PT).xlsx
    - 显示每种不良反应在不同算法的信号判定标准和结果  
  
    <img src="./pic/韦恩.png" alt="韦恩" width="250">  
    <img src="./pic/[1014]信号值（PT）-极坐标柱状图_SOC_PT_算法阈值-type2 copy_temp.png" alt="[1014]信号值（PT）-极坐标柱状图_SOC_PT_算法阈值-type2 copy_temp" width="250">   

    - PS：具体公式和代码请参考：附加的信号计算器和算法说明文件  

5. 亚组不良事件数目统计:
   - 统计目标药物引起的不良事件个数
   - 统计目标药物在老人(>=65)群体中引起的不良事件个数和百分比例
   - 统计目标药物在儿童(<18)群体中引起的不良事件个数和百分比例
   - 统计目标药物在男性/女性群体中引起的不良事件个数和百分比例  
  
   <img src="./pic/儿童不良信号统计.png" alt="儿童不良信号统计" width="450">

- #### 联用药物分析/单独用药分析

##### 1. 基本说明
- 运算符号说明：
  - "+" 表示"或"
  - "&" 表示"与" 
  - "#" 表示"非"

- 分析方法：
  - 联用分析：使用"&"，如 A&B 表示分析A药物联用B药物的情况
  - 单独用药分析：使用"#"，如 A#B 表示分析A药物单独使用(不联用B)的情况
  - **一般在亚组分析工具(小数据)中完成**，通过此方式将原始数据分组，后续进行不良时间频数、生存分析或人口学信息统计分析

##### 2. 药物联用分析实例
- <img src="./pic/药物联用输入示例.png" alt="药物联用输入示例" width="150">
注意：实际使用时，药物可能有多个名称，需要用**英文小括号**括起来，每种药物用'+'连接。即使药物仅有一个名称，也需要用小括号括起来。具体见下面的例子：
```
()&() #两种药物联用
()#() #某种药物单独使用,排除另一种药物
()&()&()... #两种或多种药物联用
()#()#()... #某种药物单独使用,排除其他药物
()&()#()#()... #两种药物联合使用，同时排除其他药物
```

**示例1：阿司匹林常和氯吡格雷联用**
- 条件：
  - Aspirin(阿司匹林)商品名：Aspirin, NORGESIC
  - Clopidogrel(氯吡格雷)商品名：Clopidogrel, PLAVIX, CLOPIDOGREL BISULFATE
- 分析方法：
  - 单独使用分析：(Aspirin+NORGESIC)#(Clopidogrel+PLAVIX+CLOPIDOGREL BISULFATE)
  - 联合使用分析：(Aspirin+NORGESIC)&(Clopidogrel+PLAVIX+CLOPIDOGREL BISULFATE)

**示例2：多药联用分析**
药物I与A、B、C三种药物的联用分析，假设这四种药物都有两种名字，实际的输入为：
- I单独使用：(I1+I2)#(A1+A2)#(B1+B2)#(C1+C2)
- I联合A使用：(I1+I2)&(A1+A2)#(B1+B2)#(C+C2)
- I联合B使用：(I1+I2)&(B1+B2)#(A1+A2)#(C1+C2)
- I联合C使用：(I1+I2)&(C1+C2)#(A1+A2)#(B1+B2)

**示例3：同名药物筛选**
问题：如何准确筛选CITALOPRAM而不包含ESCITALOPRAM？
解决方案：使用(CITALOPRAM)#(ESCITALOPRAM)

### 二、亚组分析工具（小数据）
- [B站教学视频](https://www.bilibili.com/video/BV14yVpzZEHU/)  

   <img src="./pic/亚组分析工具-小数据.png" alt="亚组分析工具-小数据" width="350">

- #### 功能定位：
1. 信号监测系统导出的报告包含目标药物(A)的总体原始数据。该工具能够对这些原始报告进行精细化拆分，支持按任意标准划分人群亚组（如1-3岁、4-7岁等年龄段的细分），并生成可与信息统计工具和绘图工具无缝对接的导出文件，特别便于分析特定亚组的不良事件发生频次并进行可视化展示。
   - 特定年龄段人群
   - 男/女性别人群
   - 重量级患者（比如体重大于90公斤的）
   - 出现了某特殊不良反应的人群（PT,SOC,SMQ）（比如心脏毒性、肌肉酸痛）
   - 患有某种疾病的人群（比如二型糖尿病）
   - 死亡或者严重结局人群
   - 药物A联用B的报告 + 药物A没有联用B的报告（分别输入A&B,A#B）
   - 特定国家或地区

- #### 运行方法：
1. 载入原始数据
2. 自由筛选
3. 保存结果，划分出来的亚组有多少报告会有提示！
4. 保存后会得到一个文件夹，请用**四、信息统计工具**选择该文件夹并执行分析。  

   
   <img src="./pic/亚组分析工具-小数据-筛选年龄.png" alt="亚组分析工具-小数据-筛选年龄" width="350">  

    <img src="./pic/小数据分割导出文件.png" alt="小数据分割导出文件" width="350">


### 三、亚组分析工具（大数据）
- [B站教学视频](https://www.bilibili.com/video/BV1CDVpz9EXK/)

<img src="./pic/大数据分割.png" alt="大数据分割" width="350">

- #### 功能定位：
1. 功能一：有时候，我们想看某个药物在特定人群中的不良反应信号值，就得先用这个软件把数据库整体划分一下再来运行信号监测系统。
   1. 比如说我要看普萘洛尔在女性群体中的信号，就可以在这里把女性的人群分出来，再做挖掘；
   2. 同理，如果我要看匹伐他汀在老人群体中的不良反应信号，就在这里把Age设定为65-120岁，把老人划出来，再做信号挖掘

2. 功能二：反着来做课题，从某种不良反应推导到药物
    - 比如说看横纹肌溶解（PT or SMQ），可能是哪些药物引起的不良反应

- #### 运行方法
1. 按下任意一个Filter（分割）按键后，会读取"./Lib_Data/Data_Lake"文件夹内的parquet数据库文件，请确保这个文件夹存在。
2. 分割选项：
    1. Sex、Age、
        - 性别：按性别分割亚组，勾选F，或者M
        - 年龄：按年龄分割亚组，填入年龄范围即可：如18-65岁、65岁-120岁
    2. Weight、Country：
        - 体重：体重划分亚组
        - 国家：选择国家代码：如果看不懂国家二字代码，可参考Readme的使用前必读文件
    3. Report Date、Outcome
        - 报告时间：根据fda_dt字段筛选
    4. Indication PT
        - 根据适应症划分亚组：比如划分阿尔兹海默症患者亚组可输入：Alzheimer
    5. PT
        - 不良反应首位语：可参考meddra辞典映射表（在Readme文件夹里）
        - 也可以划出来某类的SMQ（在Readme文件夹的SMQ文件中）
    6. Drug Combination
       - +，&，#表示或、与、非的线性运算逻辑。
       - 如果看AB两药联用，输入A&B
       - 如果看A单独使用，输入A#B
3. 保存
    - 点击Save Filtered Data
        - 选择一个文件夹，将分割好的亚组数据库保存

4. 保存后的可选操作：
   - 打开小工具文件夹中的去重工具，将得到的数据去重





### 四、信息统计工具

<img src="./pic/信息统计工具.png" alt="信息统计工具" width="350">  

- #### 功能定位：
1. 对两个亚组分析工具的导出结果，生成一个详细的基线数据分析报表，请自行尝试，有十多个统计表，都在一个工作簿里头，包括如下等信息：
   - AE频数统计
   - 报告年份统计
   - 诱发时间统计分析-韦伯分布
   - 性别分布、体重分布、年龄分布
   - 药物联用情况分析
   - 适应症分析
   - 上报者、事件结局频数统计  

    <img src="./pic/AE频数统计.png" alt="AE频数统计" width="350">  

    <img src="./pic/报告年份统计.png" alt="报告年份统计" width="350">   

2. 导出的这个工作簿当然也可以绘图，脚本编号为C开头，大概有十张图如：
   - [C0009]数据统计表-诱发时间分布图 & [C0008]数据统计表-体重段分布图 

    <img src="./pic/诱发时间图-C开头.png" alt="诱发时间图-C开头" width="350">  


    <img src="./pic/体重分布-C开头.png" alt="体重分布-C开头" width="350">      


### 五、画图工具
<img src="./pic/绘图工具使用教程.png" alt="绘图工具使用教程" width="350">

<img src="./pic/画图脚本.png" alt="画图脚本" width="350">

- #### 脚本命名规则
1. 命名：
    - 依赖数据表+图片类型+备注
2. 编号：
    - 数字开头：
        - 1000开头：信号值相关表格作图
        - 2000开头：原始数据作图
        - 3000开头：基线数据作图
    - C开头：信息统计工具导出的数据统计表绘图
    - P和S开头的作图脚本，要手动创建excel表格，[文章套路](./文章套路.md)中会给出详细指引。

### 六、特征提取工具(机器学习用)
- [bilibili:给懒人看的FAERS机器学习教程](https://www.bilibili.com/video/BV1su39zKEPX/)
-  <img src="./pic/特征提取.png" alt="特征提取" width="350">

- 执行特征提取工具，得到特征提取报告。运行脚本[S3002]等，设置模型参数和Gold Standard，自动完成建模、AUC曲线绘制、模型性能打分。
-  <img src="./pic/ML.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML1.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML2.png" alt="多亚族累计发生率" width="350">
-  <img src="./pic/ML3.png" alt="多亚族累计发生率" width="350">